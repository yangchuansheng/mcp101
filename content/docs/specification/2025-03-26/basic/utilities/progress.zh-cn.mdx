---
title: 进度通知
---

<Callout type="info">
**协议修订版本**: 2025-03-26
</Callout>

模型上下文协议（MCP）通过通知消息，为长时间运行的操作提供可选的进度跟踪支持。通信的任何一方都可以发送进度通知，以更新操作的状态。

## 进度通知流程

当一方希望*接收*某个请求的进度更新时，它会在请求的元数据（metadata）中包含一个 `progressToken`。

-   进度令牌（Progress tokens）**必须**是字符串或整数值。
-   进度令牌可以由发送方通过任何方式选择，但**必须**在所有活动请求中保持唯一。

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "某个方法",
  "params": {
    "_meta": {
      "progressToken": "abc123"
    }
  }
}
```

然后，接收方**可以**发送包含以下内容的进度通知：

-   原始的进度令牌
-   当前的进度值
-   一个可选的“总计”值
-   一个可选的“消息”值

```json
{
  "jsonrpc": "2.0",
  "method": "notifications/progress",
  "params": {
    "progressToken": "abc123",
    "progress": 50,
    "total": 100,
    "message": "正在处理中..."
  }
}
```

-   `progress` 值**必须**随着每次通知递增，即使总计值未知。
-   `progress` 和 `total` 值**可以**是浮点数。
-   `message` 字段**应当**提供相关的、人类可读的进度信息。

## 行为要求

1.  进度通知**必须**仅引用满足以下条件的令牌：
    -   在活动请求中提供。
    -   与正在进行的操作相关联。

2.  进度请求的接收方**可以**：
    -   选择不发送任何进度通知。
    -   以其认为合适的频率发送通知。
    -   如果总计值未知，则省略该值。

<Mermaid chart={`
sequenceDiagram
    participant 发送方
    participant 接收方

    Note over 发送方,接收方: 带有进度令牌的请求
    发送方->>接收方: 包含 progressToken 的方法请求

    Note over 发送方,接收方: 进度更新
    loop 进度更新
        接收方-->>发送方: 进度通知 (0.2/1.0)
        接收方-->>发送方: 进度通知 (0.6/1.0)
        接收方-->>发送方: 进度通知 (1.0/1.0)
    end

    Note over 发送方,接收方: 操作完成
    接收方->>发送方: 方法响应
`} />

## 实现说明

-   发送方和接收方**应当**跟踪活动的进度令牌。
-   双方**应当**实施速率限制，以防止通知泛滥。
-   操作完成后，**必须**停止发送进度通知。
